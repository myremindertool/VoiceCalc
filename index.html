<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Calculator</title>
  <style>
    body {
      font-family: Arial;
      background-color: #fce4ec;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #d81b60;
    }
    .calculator {
      display: inline-grid;
      grid-template-columns: repeat(4, 60px);
      gap: 10px;
      margin-top: 20px;
    }
    .btn {
      padding: 15px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: background-color 0.3s;
      cursor: pointer;
    }
    .btn.operator { background-color: #ffb74d; }
    .btn.active { background-color: #81d4fa; }
    .expression, .answer {
      font-size: 22px;
      margin-top: 20px;
    }
    #speak-btn {
      margin-top: 30px;
      padding: 15px 40px;
      font-size: 20px;
      background-color: #2196f3;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>üé§ Voice Calculator</h1>

<div class="calculator" id="calc">
  <button class="btn" id="btn-7" onclick="append('7')">7</button>
  <button class="btn" id="btn-8" onclick="append('8')">8</button>
  <button class="btn" id="btn-9" onclick="append('9')">9</button>
  <button class="btn operator" id="btn-divide" onclick="append('/')">√∑</button>

  <button class="btn" id="btn-4" onclick="append('4')">4</button>
  <button class="btn" id="btn-5" onclick="append('5')">5</button>
  <button class="btn" id="btn-6" onclick="append('6')">6</button>
  <button class="btn operator" id="btn-multiply" onclick="append('*')">√ó</button>

  <button class="btn" id="btn-1" onclick="append('1')">1</button>
  <button class="btn" id="btn-2" onclick="append('2')">2</button>
  <button class="btn" id="btn-3" onclick="append('3')">3</button>
  <button class="btn operator" id="btn-minus" onclick="append('-')">‚àí</button>

  <!-- Square root button removed -->
  <button class="btn" id="btn-0" onclick="append('0')">0</button>
  <button class="btn" id="btn-clear" onclick="clearExpression()">CLR</button>
  <button class="btn operator" id="btn-plus" onclick="append('+')">+</button>
</div>

<div class="expression" id="expression">Expression: </div>
<div class="answer" id="answer">Answer: </div>

<button id="speak-btn">üéôÔ∏è Speak</button>

<script>
  let currentExpr = "";
  const exprDisplay = document.getElementById("expression");
  const ansDisplay = document.getElementById("answer");
  const synth = window.speechSynthesis;

  const buttonMap = {
    "0": "btn-0", "1": "btn-1", "2": "btn-2", "3": "btn-3",
    "4": "btn-4", "5": "btn-5", "6": "btn-6", "7": "btn-7",
    "8": "btn-8", "9": "btn-9", "+": "btn-plus", "-": "btn-minus",
    "*": "btn-multiply", "x": "btn-multiply", "/": "btn-divide"
  };

  function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    synth.speak(utter);
  }

  function highlightButton(key) {
    const id = buttonMap[key];
    if (id) {
      const btn = document.getElementById(id);
      btn.classList.add("active");
      setTimeout(() => btn.classList.remove("active"), 1000);
    }
  }

  function showExpression() {
    exprDisplay.textContent = "Expression: " + currentExpr;
  }

  function showAnswer(ans) {
    ansDisplay.textContent = "Answer: " + ans;
    speak("The answer is " + ans);
  }

  function clearExpression() {
    currentExpr = "";
    showExpression();
    ansDisplay.textContent = "Answer: ";
  }

  function append(char) {
    currentExpr += char;
    showExpression();
    calculateAndShow(currentExpr);
  }

  function parseSpeech(speech) {
    speech = speech.toLowerCase();
    return speech
      .replace(/square of (\d+)/g, "($1**2)")
      .replace(/cube of (\d+)/g, "($1**3)")
      .replace(/plus/g, "+")
      .replace(/minus/g, "-")
      .replace(/times|multiply|multiplied by|x/g, "*")
      .replace(/divided by|divide/g, "/")
      .replace(/power of|raised to/g, "**");
  }

  function calculateAndShow(expr) {
    try {
      let safeExpr = expr;

      // No square root conversion needed anymore

      const result = Function('"use strict"; return (' + safeExpr + ')')();

      if (!isNaN(result)) {
        showAnswer(result);
      } else {
        showAnswer("Invalid");
      }
    } catch (e) {
      showAnswer("Invalid Expression");
    }
  }

  document.getElementById("speak-btn").onclick = function () {
    const recog = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recog.lang = "en-US";

    recog.onresult = function (e) {
      const speech = e.results[0][0].transcript;
      const parsed = parseSpeech(speech);
      currentExpr = parsed;
      showExpression();

      for (const char of parsed.match(/\w+|\+|\-|\*|\/|\*\*/g)) {
        highlightButton(char);
      }

      calculateAndShow(currentExpr);
    };

    recog.onerror = function () {
      ansDisplay.textContent = "Error recognizing speech";
    };

    recog.start();
  };
</script>

</body>
</html>
