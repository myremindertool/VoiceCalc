<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üé§ Voice Calculator (Mobile-friendly)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial,system-ui;background:#fce4ec;margin:0;text-align:center;padding:20px}
    h1{color:#d81b60;margin:8px 0}
    .note{color:#7a2f4b;font-size:13px;margin-top:4px}
    .panel{display:inline-block;background:#fff;border-radius:14px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.12)}
    .display{background:#fff5f8;border-radius:10px;padding:10px 12px;text-align:right;border:1px solid rgba(0,0,0,.06)}
    .expr{font-size:14px;color:#b04873;word-break:break-all;min-height:18px}
    .ans{font-size:28px;color:#4a0f26;word-break:break-all;min-height:32px}
    .status{font-size:12px;color:#7a2f4b;text-align:left;margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(4,70px);gap:10px;margin-top:14px;justify-content:center}
    .btn{padding:14px;font-size:18px;border:0;border-radius:10px;background:#fff;box-shadow:0 2px 5px rgba(0,0,0,.15);cursor:pointer;transition:.12s;user-select:none}
    .btn:active{transform:translateY(1px)}
    .btn.operator{background:#ffb74d}
    .btn.func{background:#ffecb3}
    .btn.util{background:#ffe1e7}
    .btn.equals{background:#81d4fa}
    .btn.danger{background:#ff8a80;color:#611b1b}
    .btn.active{outline:3px solid #81d4fa}
    .bar{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:14px;flex-wrap:wrap}
    .mic{display:flex;align-items:center;gap:8px;background:#ffe1e7;border:1px solid rgba(0,0,0,.08);border-radius:999px;padding:6px 10px}
    .mic .dot{width:10px;height:10px;border-radius:999px;background:#9e9e9e}
    .mic.active .dot{background:#43a047;box-shadow:0 0 0 6px rgba(67,160,71,.12)}
    .chip{font-size:12px;color:#7a2f4b;background:#fff;border:1px solid rgba(0,0,0,.06);padding:4px 8px;border-radius:999px}
    .io{display:flex;gap:8px;justify-content:center;margin:12px 0 2px;flex-wrap:wrap}
    .field{display:flex;gap:8px}
    input[type="text"]{width:min(420px,78vw);padding:12px 10px;font-size:18px;border-radius:10px;border:1px solid rgba(0,0,0,.15);background:#fff}
    #eval-btn{padding:12px 16px;font-size:16px;background:#2196f3;color:#fff;border:0;border-radius:10px}
    .footer{font-size:12px;color:#7a2f4b;margin-top:10px}
  </style>
</head>
<body>
<h1>üé§ Voice Calculator</h1>
<div class="note">Angles: <b>degrees</b>. Say ‚Äúsquare root of forty five equals‚Äù, ‚Äúsine thirty‚Äù, ‚Äútwo power three‚Äù.</div>

<div class="panel" role="application" aria-label="Advanced voice calculator">
  <div class="display" aria-live="polite">
    <div class="expr" id="expression"></div>
    <div class="ans" id="answer">0</div>
    <div class="status" id="status">Ready</div>
  </div>

  <!-- Mobile typing support -->
  <div class="io">
    <div class="field">
      <input id="exprInput" type="text" placeholder="Type expression e.g. sqrt(45)+sin(30)" inputmode="text" autocomplete="off" />
      <button id="eval-btn">Evaluate</button>
    </div>
  </div>

  <div class="grid" id="pad">
    <!-- Row 1 -->
    <button class="btn util" data-action="C">CLR</button>
    <button class="btn util" data-action="BK">‚å´</button>
    <button class="btn func" data-op="(">(</button>
    <button class="btn func" data-op=")">)</button>
    <!-- Row 2 -->
    <button class="btn func" data-fn="sqrt">‚àö</button>
    <button class="btn func" data-fn="square">x¬≤</button>
    <button class="btn func" data-fn="cube">x¬≥</button>
    <button class="btn func" data-fn="inv">1/x</button>
    <!-- Row 3 -->
    <button class="btn func" data-fn="abs">|x|</button>
    <button class="btn func" data-fn="fact">x!</button>
    <button class="btn func" data-fn="sin">sin</button>
    <button class="btn func" data-fn="cos">cos</button>
    <!-- Row 4 -->
    <button class="btn func" data-fn="tan">tan</button>
    <button class="btn func" data-fn="log">log</button>
    <button class="btn func" data-fn="ln">ln</button>
    <button class="btn operator" data-op="/">√∑</button>
    <!-- Row 5 -->
    <button class="btn" data-num="7" id="btn-7">7</button>
    <button class="btn" data-num="8" id="btn-8">8</button>
    <button class="btn" data-num="9" id="btn-9">9</button>
    <button class="btn operator" data-op="*">√ó</button>
    <!-- Row 6 -->
    <button class="btn" data-num="4" id="btn-4">4</button>
    <button class="btn" data-num="5" id="btn-5">5</button>
    <button class="btn" data-num="6" id="btn-6">6</button>
    <button class="btn operator" data-op="-">‚àí</button>
    <!-- Row 7 -->
    <button class="btn" data-num="1" id="btn-1">1</button>
    <button class="btn" data-num="2" id="btn-2">2</button>
    <button class="btn" data-num="3" id="btn-3">3</button>
    <button class="btn operator" data-op="+">+</button>
    <!-- Row 8 -->
    <button class="btn func" data-const="PI">œÄ</button>
    <button class="btn" data-num="0" id="btn-0">0</button>
    <button class="btn" data-num="." id="btn-dot">.</button>
    <button class="btn operator" data-op="^">^</button>
    <!-- Row 9 -->
    <button class="btn func" data-const="E">e</button>
    <button class="btn func" data-fn="neg">¬±</button>
    <button class="btn func" data-fn="percent">%</button>
    <button class="btn equals" data-action="EQ">=</button>
  </div>

  <div class="bar">
    <div class="mic" id="micBox" title="Voice input">
      <div class="dot"></div>
      <button class="btn" id="speak-btn">üéôÔ∏è Speak</button>
      <span id="liveText" class="chip">Tap and say: ‚Äúsquare root of forty five equals‚Äù</span>
    </div>
  </div>

  <div class="footer">
    Voice: plus/minus, times/multiply, divided by, power, percent, parentheses, root/square root, square/cube,
    sin/cos/tan, log, natural log, factorial, absolute, pi, e, equals/solve.
  </div>
</div>

<script>
(() => {
  // ---------- Elements ----------
  const exprEl = document.getElementById("expression");
  const ansEl  = document.getElementById("answer");
  const statusEl = document.getElementById("status");
  const pad = document.getElementById("pad");
  const exprInput = document.getElementById("exprInput");
  const evalBtn = document.getElementById("eval-btn");

  let expression = "";
  let justEvaluated = false;
  const TRIG_IN_DEGREES = true;

  function setStatus(s){ statusEl.textContent = s; }
  function setExpr(s){ exprEl.textContent = s; exprInput.value = s; }
  function setAns(s){ ansEl.textContent = s; }

  // ---------- Math engine ----------
  const precedence = { "+":2, "-":2, "*":3, "/":3, "^":4, "%":5, "!":5 };
  const rightAssoc = { "^":true };
  const funcs = new Set(["sqrt","square","cube","inv","fact","sin","cos","tan","log","ln","abs","neg","]()
